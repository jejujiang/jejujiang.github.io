---
title: what's C?
---

好的，我们来系统地复习一下《C程序设计语言（第二版）》（即ANSI C版本）的核心知识点。这本书由C语言之父Dennis Ritchie和Brian Kernighan编写，是学习C语言的圣经。

我们将按照书籍的大致结构，分为以下几个核心部分进行复习：

---

### 第一部分：基础语法与结构

#### 1. 第一个程序与编译运行
```c
#include <stdio.h> // 预处理指令，包含标准输入输出库

int main() {      // 主函数，程序入口
    printf("hello, world\n"); // 输出语句
    return 0;      // 返回值，0表示成功
}
```
- **编译链接过程**：`源文件 (.c) -> 编译器 -> 目标文件 (.o/.obj) -> 链接器 -> 可执行文件 (.exe/.out)`
- `main()` 函数是必须的，`int main(void)` 或 `int main(int argc, char *argv[])` 是标准形式。

#### 2. 变量、数据类型与常量
- **基本数据类型**：
    - `int`：整型
    - `float`, `double`：浮点型
    - `char`：字符型
- **限定符**：
    - `short`, `long`：修饰整型，如 `long int`
    - `signed`, `unsigned`：指定符号性
- **常量**：
    - 整型常量：`123`, `0x1F` (十六进制), `017` (八进制)
    - 浮点常量：`3.14`, `.2`, `1e-5`
    - 字符常量：`'a'`, `'\n'` (转义字符)
    - 字符串常量：`"Hello"`
    - 使用 `const` 关键字或 `#define` 宏定义常量。

#### 3. 运算符与表达式
- **算术运算符**：`+`, `-`, `*`, `/`, `%` (取模)
- **关系与逻辑运算符**：
    - 关系：`<`, `<=`, `>`, `>=`, `==`, `!=`
    - 逻辑：`&&` (与), `||` (或), `!` (非)
- **位运算符**：`&` (按位与), `|` (按位或), `^` (按位异或), `~` (按位取反), `<<` (左移), `>>` (右移)
- **赋值运算符**：`=`, `+=`, `-=`, `*=`, `/=`, `%=`, `&=`, `|=`, `^=`, `<<=`, `>>=`
- **递增递减**：`++i`, `i++`, `--i`, `i--`
- **条件运算符**：`expr1 ? expr2 : expr3`
- **逗号运算符**：`expr1, expr2`
- **sizeof 运算符**：获取类型或对象的大小（字节数）。

#### 4. 控制流
- **条件语句**：
    - `if (condition) statement`
    - `if (condition) statement else statement`
    - `switch (expression) { case const-expr: statements; ... default: statements; }`
- **循环语句**：
    - `while (condition) statement`
    - `for (expr1; expr2; expr3) statement` （`expr1`初始化，`expr2`条件，`expr3`增量）
    - `do statement while (condition);` （至少执行一次）
- **跳转语句**：
    - `break;`：跳出循环或switch。
    - `continue;`：跳过本次循环剩余部分。
    - `goto label;`：跳转到标签（慎用）。
    - `return expression;`：从函数返回。

---

### 第二部分：函数与程序结构

#### 1. 函数定义与调用
```c
// 函数声明（原型）
int max(int a, int b);

// 函数定义
int max(int a, int b) {
    return a > b ? a : b;
}

// 调用
int result = max(10, 20);
```
- **形参与实参**：形参是函数定义中的参数，实参是调用时传入的值。
- **返回值**：函数可以返回一个值（或`void`无返回）。
- **作用域规则**：
    - 局部变量：在函数或块内定义，只在内部可见。
    - 全局变量：在函数外定义，整个文件可见（可使用`extern`跨文件访问）。
- **静态变量**：`static`
    - 局部静态变量：生命周期贯穿整个程序，但作用域仍为局部。
    - 全局静态变量/函数：仅在本文件内可见（限制作用域）。

#### 2. 预处理器
- **文件包含**：`#include <stdio.h>`（系统头文件）或 `#include "myheader.h"`（用户头文件）
- **宏定义**：
    - `#define PI 3.14159` （定义常量）
    - `#define SQUARE(x) ((x) * (x))` （带参宏，注意括号避免优先级问题）
- **条件编译**：
    - `#if`, `#ifdef`, `#ifndef`, `#else`, `#elif`, `#endif`
    - 常用于防止头文件重复包含：
```c
#ifndef MYHEADER_H
#define MYHEADER_H
/* 头文件内容 */
#endif
```

---

### 第三部分：指针与数组

#### 1. 指针
- **指针变量**：存储地址的变量。
    - 声明：`int *p;` （指向int的指针）
    - 取地址运算符：`&`，如 `p = &i;`
    - 间接寻址运算符：`*`，如 `j = *p;` （获取p指向的值）
- **指针运算**：
    - 指针与整数加减：移动若干元素单位（`p + n` 前进 `n * sizeof(type)` 字节）。
    - 指针相减：得到两个指针之间的元素个数。
    - 比较：`==`, `!=`, `<`, `>` 等（通常用于同一数组内）。
- **指针与函数**：
    - 传递指针给函数可实现“按引用传递”，修改实参。
    - 函数可以返回指针（注意不要返回局部变量的地址）。

#### 2. 数组
- **一维数组**：`int arr[10];`
    - 数组名在大多数表达式中被转换为指向其首元素的指针（`arr` 等价于 `&arr[0]`）。
    - 数组下标运算 `arr[i]` 等价于 `*(arr + i)`。
- **多维数组**：`int matrix[3][4];`
    - 在内存中按行存储。
    - `matrix[i][j]` 等价于 `*(*(matrix + i) + j)`。
- **数组与指针**：
    - 数组作为函数参数时，会退化为指针（`int arr[]` 等价于 `int *arr`）。
    - 指针也可以像数组一样使用下标。

#### 3. 字符串
- 字符串是以空字符`'\0'`结尾的字符数组。
- 常用字符串函数（`<string.h>`）：
    - `strlen(s)`：返回长度（不包括`'\0'`）。
    - `strcpy(dest, src)`：复制字符串。
    - `strcat(dest, src)`：连接字符串。
    - `strcmp(s1, s2)`：比较字符串。
- **字符串常量**：`"hello"` 是一个只读的字符数组（类型为 `const char[]`），切勿修改。

#### 4. 复杂声明与指针进阶
- **指针数组**：`int *arr[10];` （数组元素是指针）
- **数组指针**：`int (*arr)[10];` （指向长度为10的数组的指针）
- **函数指针**：
    - 声明：`int (*pf)(int, int);` （指向返回int，参数为两个int的函数的指针）
    - 赋值：`pf = max;`
    - 调用：`(*pf)(a, b)` 或 `pf(a, b)`
- `const` 与指针：
    - `const int *p;`：指向常量的指针（不能通过p修改所指内容）。
    - `int *const p;`：常量指针（指针本身不可变）。
    - `const int *const p;`：指向常量的常量指针。

---

### 第四部分：结构体、联合与内存管理

#### 1. 结构体 (struct)
- 定义复合数据类型：
```c
struct point {
    int x;
    int y;
};

// 声明变量
struct point p1 = {1, 2};
struct point p2 = {.y=2, .x=1}; // C99指定初始化器

// 通过指针访问成员
struct point *pp = &p1;
(*pp).x = 10;
pp->x = 10; // 等价写法
```
- 结构体可以嵌套，可以包含数组、指针甚至其他结构体。
- 结构体大小可能包含填充字节（内存对齐）。

#### 2. 联合 (union)
- 所有成员共享同一块内存（大小由最大成员决定）。
```c
union data {
    int i;
    float f;
    char str[20];
};
```
- 同一时间只能使用一个成员。

#### 3. 枚举 (enum)
- 定义一组命名的整数常量。
```c
enum color { RED, GREEN, BLUE }; // RED=0, GREEN=1, BLUE=2
enum color c = RED;
```

#### 4. 动态内存管理
- `malloc(size_t size)`：分配指定字节数的内存，返回`void*`（需要类型转换）。
- `calloc(size_t nmemb, size_t size)`：分配数组（初始化为0）。
- `realloc(void *ptr, size_t size)`：调整已分配内存的大小。
- `free(void *ptr)`：释放内存。
- **示例**：
```c
int *arr = (int*)malloc(10 * sizeof(int));
if (arr == NULL) {
    // 处理分配失败
}
// 使用...
free(arr);
arr = NULL; // 避免野指针
```
- **重要**：务必检查返回值是否为`NULL`，防止内存泄漏（分配后必须释放）。

---

### 第五部分：输入输出与文件操作

#### 1. 标准输入输出
- `printf(format, ...)`：格式化输出。
    - 格式控制：`%d`, `%f`, `%c`, `%s`, `%p`, `%x` 等。
- `scanf(format, ...)`：格式化输入。
    - 注意：需要传递变量的地址（`&变量`），字符串数组名不用（因为是指针）。
- `getchar()`, `putchar(c)`：字符输入输出。

#### 2. 文件操作
- 文件指针：`FILE *fp;`
- 打开文件：`fopen(filename, mode)`
    - 模式：`"r"`（读），`"w"`（写），`"a"`（追加），`"r+"`（读写）等。
- 关闭文件：`fclose(fp)`
- 字符I/O：`getc(fp)`, `putc(c, fp)`
- 行I/O：`fgets(buf, size, fp)`, `fputs(buf, fp)`
- 格式化I/O：`fprintf(fp, format, ...)`, `fscanf(fp, format, ...)`
- 块I/O：`fread(ptr, size, nmemb, fp)`, `fwrite(ptr, size, nmemb, fp)`
- 文件定位：`fseek(fp, offset, whence)`（`SEEK_SET`, `SEEK_CUR`, `SEEK_END`），`ftell(fp)`，`rewind(fp)`
- 错误处理：`feof(fp)`（检查文件结束），`ferror(fp)`（检查错误）。

---

### 第六部分：高级话题与最佳实践

#### 1. 可变参数函数
- 使用 `<stdarg.h>` 中的宏：
    - `va_list`：声明参数列表变量。
    - `va_start(ap, last_fixed_param)`：初始化。
    - `va_arg(ap, type)`：获取下一个参数。
    - `va_end(ap)`：清理。
- 示例：实现一个简单的可变参数函数（如`printf`）。

#### 2. 库函数
- 标准库（ANSI C）包含：
    - `<stdio.h>`：输入输出。
    - `<stdlib.h>`：动态内存、随机数等。
    - `<string.h>`：字符串处理。
    - `<math.h>`：数学函数。
    - `<ctype.h>`：字符分类。
    - `<time.h>`：时间日期。
    - 等等。

#### 3. 常见陷阱与最佳实践
- **未初始化变量**：尤其是指针。
- **数组越界**：导致未定义行为。
- **内存泄漏**：分配后忘记释放。
- **野指针**：使用已释放或未初始化的指针。
- **修改字符串常量**：`char *s = "hello"; s[0] = 'H';` （错误！）。
- **宏的副作用**：`#define SQUARE(x) x*x`，`SQUARE(i++)` 会递增两次。
- **运算符优先级**：不确定时加括号。
- **使用 `==` 判断浮点数相等**：应使用精度判断（`fabs(a - b) < epsilon`）。

---

### 总结

要牢固掌握ANSI C，必须理解：
1.  **指针和内存管理**：这是C的核心与难点。
2.  **数组与指针的关系**：理解它们之间的等价性和差异。
3.  **函数和程序结构**：如何组织代码，使用头文件。
4.  **标准库**：熟练使用常用库函数。

**最好的复习方法是结合实践**：
- 重读书中的经典例子（如逆波兰计算器、排序、链表等）。
- 动手编写、调试代码，解决实际问题。
- 使用工具如 `gcc -Wall -g` 编译，使用 `gdb` 调试，使用 `valgrind` 检查内存错误。
